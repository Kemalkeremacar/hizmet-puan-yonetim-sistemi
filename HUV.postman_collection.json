{
  "info": {
    "name": "HUV API",
    "_postman_id": "2f2b0c7a-8e8b-4e0a-a2c3-4c6f9f3c1b5a",
    "description": "HUV Yönetim Sistemi API Collection (Auth + External + Admin). Değişkenler: baseUrl, token.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000/api", "type": "string" },
    { "key": "token", "value": "", "type": "string" },
    { "key": "adminUsername", "value": "admin", "type": "string" },
    { "key": "adminPassword", "value": "admin123", "type": "string" },
    { "key": "userUsername", "value": "user", "type": "string" },
    { "key": "userPassword", "value": "user123", "type": "string" },
    { "key": "versionId", "value": "1", "type": "string" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login (User) - sets token",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"kullaniciAdi\": \"{{userUsername}}\",\n  \"sifre\": \"{{userPassword}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "let json = {};",
                  "try { json = pm.response.json(); } catch (e) {}",
                  "const token = json?.data?.token || json?.token;",
                  "if (token) pm.collectionVariables.set('token', token);",
                  "const rol = json?.data?.user?.rol || json?.user?.rol;",
                  "if (rol) pm.collectionVariables.set('role', rol);",
                  "pm.test('login success', function () {",
                  "  pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "  pm.expect(!!token).to.eql(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Login (Admin) - sets token",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"kullaniciAdi\": \"{{adminUsername}}\",\n  \"sifre\": \"{{adminPassword}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "let json = {};",
                  "try { json = pm.response.json(); } catch (e) {}",
                  "const token = json?.data?.token || json?.token;",
                  "if (token) pm.collectionVariables.set('token', token);",
                  "const rol = json?.data?.user?.rol || json?.user?.rol;",
                  "if (rol) pm.collectionVariables.set('role', rol);",
                  "pm.test('login success', function () {",
                  "  pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "  pm.expect(!!token).to.eql(true);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Me",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/auth/me", "host": ["{{baseUrl}}"], "path": ["auth", "me"] }
          }
        },
        {
          "name": "Logout",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/auth/logout", "host": ["{{baseUrl}}"], "path": ["auth", "logout"] }
          }
        }
      ]
    },
    {
      "name": "External (2-level)",
      "item": [
        {
          "name": "HUV List",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/external/huv", "host": ["{{baseUrl}}"], "path": ["external", "huv"] }
          }
        },
        {
          "name": "HUV Changes (latest import)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/external/huv/changes", "host": ["{{baseUrl}}"], "path": ["external", "huv", "changes"] }
          }
        },
        {
          "name": "SUT List",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/external/sut", "host": ["{{baseUrl}}"], "path": ["external", "sut"] }
          }
        },
        {
          "name": "SUT Changes (latest import)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/external/sut/changes", "host": ["{{baseUrl}}"], "path": ["external", "sut", "changes"] }
          }
        },
        {
          "name": "İl Katsayı List",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/external/il-katsayi", "host": ["{{baseUrl}}"], "path": ["external", "il-katsayi"] }
          }
        },
        {
          "name": "İl Katsayı Changes (latest import)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/external/il-katsayi/changes", "host": ["{{baseUrl}}"], "path": ["external", "il-katsayi", "changes"] }
          }
        }
      ]
    },
    {
      "name": "Internal (UI APIs - Authenticated)",
      "item": [
        {
          "name": "HUV İşlemler",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/islemler", "host": ["{{baseUrl}}"], "path": ["islemler"] }
          }
        },
        {
          "name": "HUV Ana Dallar",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/anadal", "host": ["{{baseUrl}}"], "path": ["anadal"] }
          }
        },
        {
          "name": "SUT Liste (UI)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/sut", "host": ["{{baseUrl}}"], "path": ["sut"] }
          }
        }
      ]
    },
    {
      "name": "Admin (ADMIN only)",
      "item": [
        {
          "name": "Versiyonlar (listeTipi=HUV)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/admin/versiyonlar?listeTipi=HUV",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "versiyonlar"],
              "query": [{ "key": "listeTipi", "value": "HUV" }]
            }
          }
        },
        {
          "name": "Versiyon Detay (by versionId)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/versiyonlar/{{versionId}}", "host": ["{{baseUrl}}"], "path": ["admin", "versiyonlar", "{{versionId}}"] }
          }
        },
        {
          "name": "Import Status",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/import/status", "host": ["{{baseUrl}}"], "path": ["admin", "import", "status"] }
          }
        },
        {
          "name": "Preview Import (HUV generic) - multipart file",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": "" }]
            },
            "url": { "raw": "{{baseUrl}}/admin/import/preview", "host": ["{{baseUrl}}"], "path": ["admin", "import", "preview"] }
          }
        },
        {
          "name": "Import HUV - multipart file",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": "" }]
            },
            "url": { "raw": "{{baseUrl}}/admin/import/huv", "host": ["{{baseUrl}}"], "path": ["admin", "import", "huv"] }
          }
        },
        {
          "name": "Preview SUT - multipart file",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": "" }]
            },
            "url": { "raw": "{{baseUrl}}/admin/import/sut/preview", "host": ["{{baseUrl}}"], "path": ["admin", "import", "sut", "preview"] }
          }
        },
        {
          "name": "Import SUT - multipart file",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": "" }]
            },
            "url": { "raw": "{{baseUrl}}/admin/import/sut", "host": ["{{baseUrl}}"], "path": ["admin", "import", "sut"] }
          }
        },
        {
          "name": "Preview İl Katsayı - multipart file",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": "" }]
            },
            "url": { "raw": "{{baseUrl}}/admin/import/il-katsayi/preview", "host": ["{{baseUrl}}"], "path": ["admin", "import", "il-katsayi", "preview"] }
          }
        },
        {
          "name": "Import İl Katsayı - multipart file",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "POST",
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": "" }]
            },
            "url": { "raw": "{{baseUrl}}/admin/import/il-katsayi", "host": ["{{baseUrl}}"], "path": ["admin", "import", "il-katsayi"] }
          }
        },
        {
          "name": "Import Report (by versionId)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/import/report/{{versionId}}", "host": ["{{baseUrl}}"], "path": ["admin", "import", "report", "{{versionId}}"] }
          }
        }
      ]
    },
    {
      "name": "Tarihsel Sorgular",
      "item": [
        {
          "name": "HUV - Belirli Tarihteki Fiyat",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/fiyat?huvKodu=1.01&tarih=2025-10-07",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "fiyat"],
              "query": [
                { "key": "huvKodu", "value": "1.01", "description": "HUV Kodu (örn: 1.01)" },
                { "key": "tarih", "value": "2025-10-07", "description": "YYYY-MM-DD formatında tarih (min: 2025-10-07)" }
              ]
            }
          }
        },
        {
          "name": "HUV - Tarih Aralığında Değişenler",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/degisen?baslangic=2025-10-07&bitis=2025-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "degisen"],
              "query": [
                { "key": "baslangic", "value": "2025-10-07", "description": "YYYY-MM-DD (min: 2025-10-07)" },
                { "key": "bitis", "value": "2025-12-31", "description": "YYYY-MM-DD (min: 2025-10-07)" },
                { "key": "anaDalKodu", "value": "", "description": "Opsiyonel: Ana dal kodu filtresi" }
              ]
            }
          }
        },
        {
          "name": "HUV - Fiyat Geçmişi (by HUV Kodu)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/gecmis/1.01",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "gecmis", "1.01"]
            },
            "description": "HUV Kodu veya İşlem ID ile tüm fiyat geçmişi"
          }
        },
        {
          "name": "HUV - Yaşam Döngüsü (by HUV Kodu)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/yasam-dongusu/1.01",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "yasam-dongusu", "1.01"]
            },
            "description": "HUV Kodu veya İşlem ID ile yaşam döngüsü (eklenme, güncellenme, silinme olayları)"
          }
        },
        {
          "name": "HUV - Versiyonlar (by İşlem ID)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/versiyonlar/1",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "versiyonlar", "1"]
            }
          }
        },
        {
          "name": "SUT - Belirli Tarihteki Puan",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/puan?sutKodu=1.01.001&tarih=2026-01-01",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "puan"],
              "query": [
                { "key": "sutKodu", "value": "1.01.001", "description": "SUT Kodu (örn: 1.01.001)" },
                { "key": "tarih", "value": "2026-01-01", "description": "YYYY-MM-DD formatında tarih (min: 2026-01-01)" }
              ]
            }
          }
        },
        {
          "name": "SUT - Tarih Aralığında Değişenler",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/degisen?baslangic=2026-01-01&bitis=2026-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "degisen"],
              "query": [
                { "key": "baslangic", "value": "2026-01-01", "description": "YYYY-MM-DD (min: 2026-01-01)" },
                { "key": "bitis", "value": "2026-12-31", "description": "YYYY-MM-DD (min: 2026-01-01)" },
                { "key": "anaBaslikNo", "value": "", "description": "Opsiyonel: Ana başlık no filtresi" }
              ]
            }
          }
        },
        {
          "name": "SUT - Puan Geçmişi (by SUT Kodu)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/gecmis/1.01.001",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "gecmis", "1.01.001"]
            },
            "description": "SUT Kodu veya SUT ID ile tüm puan geçmişi"
          }
        },
        {
          "name": "SUT - Yaşam Döngüsü (by SUT Kodu)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/yasam-dongusu/1.01.001",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "yasam-dongusu", "1.01.001"]
            },
            "description": "SUT Kodu veya SUT ID ile yaşam döngüsü (eklenme, güncellenme, silinme olayları)"
          }
        },
        {
          "name": "SUT - Versiyonlar (by SUT ID)",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/versiyonlar/1",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "versiyonlar", "1"]
            }
          }
        },
        {
          "name": "SUT - Versiyon Karşılaştırma",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/karsilastir?eskiVersiyon=1&yeniVersiyon=2",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "karsilastir"],
              "query": [
                { "key": "eskiVersiyon", "value": "1", "description": "Eski versiyon ID" },
                { "key": "yeniVersiyon", "value": "2", "description": "Yeni versiyon ID" }
              ]
            }
          }
        },
        {
          "name": "SUT - Tarihsel İstatistikler",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tarihsel/sut/stats",
              "host": ["{{baseUrl}}"],
              "path": ["tarihsel", "sut", "stats"]
            }
          }
        }
      ]
    }
  ]
}

